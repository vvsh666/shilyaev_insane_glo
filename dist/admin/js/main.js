(()=>{"use strict";const t=t=>{const e=document.getElementById("tbody");e.innerHTML="",t.forEach((t=>{const n=document.createElement("tr");n.className="table__row",n.innerHTML=`\n            <td class="table__id table__cell">${t.id}</td>\n            <td class="table-type table__cell">${t.type}</td>\n            <td class="table-name table__cell">${t.name}</td>\n            <td class="table-units table__cell">${t.units}</td>\n            <td class="table-cost table__cell">${t.cost}</td>\n            <td>\n                <div class="table__actions table__cell">\n                    <button class="button action-change"><span class="svg_ui"><svg\n                                class="action-icon_change">\n                                <use xlink:href="./img/sprite.svg#change"></use>\n                            </svg></span><span>Изменить</span>\n                    </button>\n                    <button class="button action-remove"><span class="svg_ui"><svg\n                                class="action-icon_remove">\n                                <use xlink:href="./img/sprite.svg#remove"></use>\n                            </svg></span><span>Удалить</span>\n                    </button>\n                </div>\n            </td>\n        `,e.append(n)}))},e=new class{async getRepair(){const t=await fetch("http://localhost:4545/repairs");return await t.json()}async filterRepair(t){const e=await fetch(`http://localhost:4545/repairs/?type=${t}`);return await e.json()}async addRepair(t){const e=await fetch("http://localhost:4545/repairs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return await e.json()}async removeRepair(t){const e=await fetch(`http://localhost:4545/repairs/${t}`,{method:"DELETE"});return await e.json()}async getRepairItem(t){const e=await fetch(`http://localhost:4545/repairs/${t}`);return await e.json()}async editRepairItem(t,e){const n=await fetch(`http://localhost:4545/repairs/${t}`,{method:"PATCH",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}});return await n.json()}async getSortRepair(t,e){let n;return n="Все услуги"===e?await fetch(`http://localhost:4545/repairs?_sort=${t.name}&_order=${t.value?"asc":"desc"}`):await fetch(`http://localhost:4545/repairs/?type=${e}&_sort=${t.name}&_order=${t.value?"asc":"desc"}`),await n.json()}},n=new class{async getUser(t){const e=await fetch(`http://localhost:4545/users?login=${t}`),n=await e.json(),[a]=await n;return a}};document.URL===`http://${window.location.host}/dist/admin/table.html`?((t=>{const e=t=>{let e=document.cookie.match(new RegExp("(?:^|; )"+t.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return e?decodeURIComponent(e[1]):void 0},n=()=>{document.location.href=`http://${window.location.host}/dist/admin/`};document.addEventListener("DOMContentLoaded",(()=>{const a=e("login"),o=e("password");a||o?t.getUser(a).then((t=>{if(t){if(t.login===a&&t.password===o)return;n()}else n()})):n()}))})(n),(e=>{const n=document.getElementById("typeItem");e.getRepair().then((e=>{let a=[];e.forEach((t=>{t.type&&a.push(t.type)})),a=[...new Set(a)],a.forEach((t=>{const e=document.createElement("option");e.value=t,e.textContent=t,n.append(e)})),t(e)}))})(e),(e=>{document.getElementById("typeItem").addEventListener("change",(n=>{"Все услуги"===n.target.value?e.getRepair().then((e=>{t(e)})):e.filterRepair(n.target.value).then((e=>{t(e)}))}))})(e),(e=>{const n=document.querySelector(".btn-addItem"),a=document.getElementById("modal"),o=a.querySelector("form"),s=o.querySelector("#type"),r=o.querySelector("#name"),l=o.querySelector("#units"),c=o.querySelector("#cost");n.addEventListener("click",(()=>{a.style.display="flex"})),a.addEventListener("click",(n=>{if(n.preventDefault(),(n.target.closest(".button__close")||n.target.closest(".cancel-button"))&&(a.style=""),n.target.closest(".button-ui_firm")&&(n.preventDefault(),"edit"!==o.dataset.method)){const n={type:s.value,name:r.value,units:l.value,cost:c.value};e.addRepair(n).then((a=>{e.filterRepair(n.type).then((e=>{t(e),o.reset()}))}))}}))})(e),(e=>{const n=document.getElementById("tbody"),a=document.getElementById("typeItem"),o=document.getElementById("modal"),s=o.querySelector(".modal__header"),r=o.querySelector("form"),l=r.querySelector("#type"),c=r.querySelector("#name"),i=r.querySelector("#units"),d=r.querySelector("#cost");n.addEventListener("click",(t=>{if(t.target.closest(".action-change")){const n=t.target.closest("tr").querySelector(".table__id").textContent;e.getRepairItem(n).then((t=>{l.value=t.type,c.value=t.name,i.value=t.units,d.value=t.cost,r.dataset.method="edit",r.dataset.id=n,s.textContent="Редактирование услуги",o.style.display="flex"}))}})),o.addEventListener("click",(n=>{if(n.preventDefault(),(n.target.closest(".button__close")||n.target.closest(".cancel-button"))&&(o.style="",s.textContent="Добавление новой услуги",r.removeAttribute("data-method"),r.removeAttribute("data-id")),n.target.closest(".button-ui_firm")){n.preventDefault();const u=r.dataset.id,m=a.value;if("edit"===r.dataset.method){const n={type:l.value,name:c.value,units:i.value,cost:d.value};e.editRepairItem(u,n).then((n=>{"Все услуги"===m?e.getRepair().then((e=>{t(e)})):e.filterRepair(m).then((e=>{t(e)})),r.reset(),o.style="",s.textContent="Добавление новой услуги",r.removeAttribute("data-method"),r.removeAttribute("data-id")}))}}}))})(e),(e=>{const n=document.getElementById("tbody"),a=document.getElementById("typeItem");n.addEventListener("click",(n=>{if(n.target.closest(".action-remove")){const o=n.target.closest("tr").querySelector(".table__id").textContent,s=a.value;e.removeRepair(o).then((n=>{"Все услуги"===s?e.getRepair().then((e=>{t(e)})):e.filterRepair(s).then((e=>{t(e)}))}))}}))})(e),(e=>{const n=document.getElementById("typeItem"),a=document.querySelector("thead");let o={},s=!1,r=!1,l=!1,c=!1;a.addEventListener("click",(a=>{if(a.target.closest(".th-id")){const t=a.target.closest(".th-id").querySelector("svg");s=!s,s?t.style.transform="rotateX(180deg)":t.style="",o={name:"id",value:s}}if(a.target.closest(".th-type")){const t=a.target.closest(".th-type").querySelector("svg");r=!r,r?t.style.transform="rotateX(180deg)":t.style="",o={name:"type",value:r}}if(a.target.closest(".th-name")){const t=a.target.closest(".th-name").querySelector("svg");l=!l,l?t.style.transform="rotateX(180deg)":t.style="",o={name:"name",value:l}}if(a.target.closest(".th-units")){const t=a.target.closest(".th-units").querySelector("svg");c=!c,c?t.style.transform="rotateX(180deg)":t.style="",o={name:"units",value:c}}e.getSortRepair(o,n.value).then((e=>{t(e)}))}))})(e)):document.URL===`http://${window.location.host}/dist/admin/`&&(t=>{const e=document.querySelector("form"),n=e.querySelectorAll("input"),a=document.getElementById("name"),o=document.getElementById("type"),s=e.querySelector("#name + .text-warning"),r=e.querySelector("#type + .text-warning");e.addEventListener("submit",(n=>{n.preventDefault(),t.getUser(a.value).then((t=>{t?t.password!==o.value?(r.textContent="Не верный пароль",e.reset()):(document.cookie=`login=${a.value}`,document.cookie=`password=${o.value}`,document.location.href=`http://${window.location.host}/dist/admin/table.html`):(s.textContent="Не верное имя",e.reset())}))})),n.forEach((t=>{t.addEventListener("input",(()=>{s.textContent="",r.textContent=""}))}))})(n)})();