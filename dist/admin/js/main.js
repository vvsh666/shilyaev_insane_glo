(()=>{"use strict";const t=t=>{const e=document.getElementById("tbody");e.innerHTML="",t.forEach((t=>{const a=document.createElement("tr");a.className="table__row",a.innerHTML=`\n            <td class="table__id table__cell">${t.id}</td>\n            <td class="table-type table__cell">${t.type}</td>\n            <td class="table-name table__cell">${t.name}</td>\n            <td class="table-units table__cell">${t.units}</td>\n            <td class="table-cost table__cell">${t.cost}</td>\n            <td>\n                <div class="table__actions table__cell">\n                    <button class="button action-change"><span class="svg_ui"><svg\n                                class="action-icon_change">\n                                <use xlink:href="./img/sprite.svg#change"></use>\n                            </svg></span><span>Изменить</span>\n                    </button>\n                    <button class="button action-remove"><span class="svg_ui"><svg\n                                class="action-icon_remove">\n                                <use xlink:href="./img/sprite.svg#remove"></use>\n                            </svg></span><span>Удалить</span>\n                    </button>\n                </div>\n            </td>\n        `,e.append(a)}))},e=new class{async getRepair(){const t=await fetch("http://localhost:4545/repairs");return await t.json()}async filterRepair(t){const e=await fetch(`http://localhost:4545/repairs/?type=${t}`);return await e.json()}async addRepair(t){const e=await fetch("http://localhost:4545/repairs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return await e.json()}async removeRepair(t){const e=await fetch(`http://localhost:4545/repairs/${t}`,{method:"DELETE"});return await e.json()}async getRepairItem(t){const e=await fetch(`http://localhost:4545/repairs/${t}`);return await e.json()}async editRepairItem(t,e){const a=await fetch(`http://localhost:4545/repairs/${t}`,{method:"PATCH",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}});return await a.json()}async getSortRepair(t,e){let a;return a="Все услуги"===e?await fetch(`http://localhost:4545/repairs?_sort=${t.name}&_order=${t.value?"asc":"desc"}`):await fetch(`http://localhost:4545/repairs/?type=${e}&_sort=${t.name}&_order=${t.value?"asc":"desc"}`),await a.json()}},a=new class{async getUser(t){const e=await fetch(`http://localhost:4545/users?login=${t}`),a=await e.json(),[n]=await a;return n}};document.URL===`http://${window.location.host}/dist/admin/table.html`?((t=>{const e=t=>{let e=document.cookie.match(new RegExp("(?:^|; )"+t.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return e?decodeURIComponent(e[1]):void 0},a=()=>{document.location.href=`http://${window.location.host}/dist/admin/`};document.addEventListener("DOMContentLoaded",(()=>{const n=e("login"),o=e("password");n||o?t.getUser(n).then((t=>{if(t){if(t.login===n&&t.password===o)return;a()}else a()})):a()}))})(a),(e=>{const a=document.getElementById("typeItem");e.getRepair().then((e=>{let n=[];e.forEach((t=>{t.type&&n.push(t.type)})),n=[...new Set(n)],n.forEach((t=>{const e=document.createElement("option");e.value=t,e.textContent=t,a.append(e)})),t(e)}))})(e),(e=>{document.getElementById("typeItem").addEventListener("change",(a=>{"Все услуги"===a.target.value?e.getRepair().then((e=>{t(e)})):e.filterRepair(a.target.value).then((e=>{t(e)}))}))})(e),(e=>{const a=document.querySelector(".btn-addItem"),n=document.getElementById("modal"),o=n.querySelector("form"),s=o.querySelectorAll("input"),r=o.querySelector("#type"),l=o.querySelector("#name"),c=o.querySelector("#units"),i=o.querySelector("#cost");a.addEventListener("click",(()=>{n.style.display="flex"})),n.addEventListener("click",(a=>{if(a.preventDefault(),(a.target.closest(".button__close")||a.target.closest(".cancel-button"))&&(n.style=""),a.target.closest(".button-ui_firm")&&(a.preventDefault(),"edit"!==o.dataset.method&&(()=>{let t=!0;return s.forEach((e=>{"type"!==e.id&&"name"!==e.id&&"units"!==e.id||""===e.value&&(t=!1,e.style.borderBottom="2px solid red"),"cost"===e.id&&(""===e.value||/\D+/g.test(e.value))&&(t=!1,e.style.borderBottom="2px solid red")})),t})())){const a={type:r.value,name:l.value,units:c.value,cost:i.value};e.addRepair(a).then((n=>{e.filterRepair(a.type).then((e=>{t(e),o.reset()}))}))}})),s.forEach((t=>{t.addEventListener("input",(t=>{t.target.style="",t.target===i&&(t.target.value=t.target.value.replace(/\D+/,""))}))}))})(e),(e=>{const a=document.getElementById("tbody"),n=document.getElementById("typeItem"),o=document.getElementById("modal"),s=o.querySelector(".modal__header"),r=o.querySelector("form"),l=r.querySelectorAll("input"),c=r.querySelector("#type"),i=r.querySelector("#name"),d=r.querySelector("#units"),u=r.querySelector("#cost");a.addEventListener("click",(t=>{if(t.target.closest(".action-change")){const a=t.target.closest("tr").querySelector(".table__id").textContent;e.getRepairItem(a).then((t=>{c.value=t.type,i.value=t.name,d.value=t.units,u.value=t.cost,r.dataset.method="edit",r.dataset.id=a,s.textContent="Редактирование услуги",o.style.display="flex"}))}})),o.addEventListener("click",(a=>{if(a.preventDefault(),(a.target.closest(".button__close")||a.target.closest(".cancel-button"))&&(o.style="",s.textContent="Добавление новой услуги",r.removeAttribute("data-method"),r.removeAttribute("data-id")),a.target.closest(".button-ui_firm")){a.preventDefault();const m=r.dataset.id,p=n.value;if("edit"===r.dataset.method&&(()=>{let t=!0;return l.forEach((e=>{"type"!==e.id&&"name"!==e.id&&"units"!==e.id||""===e.value&&(t=!1,e.style.borderBottom="2px solid red"),"cost"===e.id&&(""===e.value||/\D+/g.test(e.value))&&(t=!1,e.style.borderBottom="2px solid red")})),t})()){const a={type:c.value,name:i.value,units:d.value,cost:u.value};e.editRepairItem(m,a).then((a=>{"Все услуги"===p?e.getRepair().then((e=>{t(e)})):e.filterRepair(p).then((e=>{t(e)})),r.reset(),o.style="",s.textContent="Добавление новой услуги",r.removeAttribute("data-method"),r.removeAttribute("data-id")}))}}}))})(e),(e=>{const a=document.getElementById("tbody"),n=document.getElementById("typeItem");a.addEventListener("click",(a=>{if(a.target.closest(".action-remove")){const o=a.target.closest("tr").querySelector(".table__id").textContent,s=n.value;e.removeRepair(o).then((a=>{"Все услуги"===s?e.getRepair().then((e=>{t(e)})):e.filterRepair(s).then((e=>{t(e)}))}))}}))})(e),(e=>{const a=document.getElementById("typeItem"),n=document.querySelector("thead");let o={},s=!1,r=!1,l=!1,c=!1;n.addEventListener("click",(n=>{if(n.target.closest(".th-id")){const t=n.target.closest(".th-id").querySelector("svg");s=!s,s?t.style.transform="rotateX(180deg)":t.style="",o={name:"id",value:s}}if(n.target.closest(".th-type")){const t=n.target.closest(".th-type").querySelector("svg");r=!r,r?t.style.transform="rotateX(180deg)":t.style="",o={name:"type",value:r}}if(n.target.closest(".th-name")){const t=n.target.closest(".th-name").querySelector("svg");l=!l,l?t.style.transform="rotateX(180deg)":t.style="",o={name:"name",value:l}}if(n.target.closest(".th-units")){const t=n.target.closest(".th-units").querySelector("svg");c=!c,c?t.style.transform="rotateX(180deg)":t.style="",o={name:"units",value:c}}e.getSortRepair(o,a.value).then((e=>{t(e)}))}))})(e)):document.URL===`http://${window.location.host}/dist/admin/`&&(t=>{const e=document.querySelector("form"),a=e.querySelectorAll("input"),n=document.getElementById("name"),o=document.getElementById("type"),s=e.querySelector("#name + .text-warning"),r=e.querySelector("#type + .text-warning");e.addEventListener("submit",(a=>{a.preventDefault(),t.getUser(n.value).then((t=>{t?t.password!==o.value?(r.textContent="Не верный пароль",e.reset()):(document.cookie=`login=${n.value}`,document.cookie=`password=${o.value}`,document.location.href=`http://${window.location.host}/dist/admin/table.html`):(s.textContent="Не верное имя",e.reset())}))})),a.forEach((t=>{t.addEventListener("input",(()=>{s.textContent="",r.textContent=""}))}))})(a)})();